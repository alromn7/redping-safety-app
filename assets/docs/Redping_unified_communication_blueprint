# RedPing Unified Communication Blueprint

## 1. Overview

This document outlines the definitive communication workflow for the entire RedPing Safety Ecosystem. Its purpose is to establish a single, unified data flow model that ensures seamless, real-time interaction between the end-user (via the Flutter App) and the emergency responders (via the SAR Website).

## 2. Core Principle: A Single Source of Truth

The entire system is built around one central principle: **a single source of truth**. All emergency data, from initial alert to final resolution, will reside in one specific location.

**Central Hub:** The `sos_sessions` collection within the `redping-a2e37` Firebase Firestore database.

All clients—the user's mobile app and the SAR coordinator's website—will read from and write to this single collection. This eliminates data silos, prevents synchronization errors, and guarantees that all parties are viewing the exact same information in real-time.

## 3. System Components

*   **RedPing Mobile App (Flutter):** The client used by the person in distress. It is responsible for *sending* the SOS and *displaying the status* of that specific SOS back to the user.
*   **RedPing SAR Dashboard (Next.js):** The client used by the SAR coordinators. It is responsible for *viewing all active SOS alerts* and *updating their status*.
*   **Firebase Firestore:** The cloud-hosted, real-time database that serves as the central communication hub.

## 4. The Unified Workflow: End-to-End

This is the step-by-step flow of information during an emergency incident.

### Step 1: SOS Activation (User App)
1.  A user in distress triggers the SOS function in the Flutter app.
2.  The app gathers essential data: User ID, current GPS location, timestamp, and emergency type.
3.  The app writes a **new document** directly to the `sos_sessions` collection in Firestore. This document has an initial `status` of `'active'`.

### Step 2: Real-time Alert (SAR Website)
1.  The SAR Dashboard website has a persistent, real-time listener attached to the `sos_sessions` collection, specifically querying for documents where `status` is `'active'`.
2.  The new SOS document from Step 1 appears instantly on the SAR dashboard, alerting the coordinator.

### Step 3: User Confirmation (User App)
1.  Simultaneously, the user's app navigates to a "My SOS Status" screen.
2.  This screen has its own real-time listener on the `sos_sessions` collection, but it is filtered to show *only the document created by that specific user*.
3.  The user sees their own SOS details appear on their screen, providing immediate confirmation that the alert was successfully transmitted.

### Step 4: Responder Action (SAR Website)
1.  The SAR coordinator sees the new alert on the website dashboard and takes action (e.g., dispatches a team).
2.  The coordinator updates the status of the SOS document directly in Firestore, changing the `status` field from `'active'` to `'responder_assigned'`.

### Step 5: Real-time Feedback (User App)
1.  The listener on the user's "My SOS Status" screen (from Step 3) instantly detects the change to the document.
2.  The app's UI updates in real-time, informing the user: "A responder has been assigned." This provides crucial feedback and reassurance to the person in distress.

## 5. Architectural Diagram

```
                               +--------------------------+
                               |                          |
(1. Writes SOS)--------------> |  Firestore Database      | <------------(2. Reads All SOS)
                               |  (sos_sessions Collection)|
(3. Reads Own SOS) <-----------|                          | ------------>(4. Updates Status)
                               +--------------------------+
       ^                             ^            ^                             |
       |                             |            |                             |
       | (5. Receives Status Update) |            |                             |
       |                             |            |                             |
+------------------+                 |            +-------------------+
|                  |                 |            |                   |
| RedPing App      |-----------------+            | SAR Website       |
| (User)           |                              | (Coordinator)     |
|                  |                              |                   |
+------------------+                              +-------------------+
```
